# 📚 자바와 JUnit을 활용한 실용주의 단위 테스트 
## 📖 3부 더 큰 설계 그림

단위 테스트는 단지 '설계'라고 하는 더 큰 그림의 일부에 불과하다. 시스템을 개발하면서 코드 설계를 깔끔하게 유지하고 싶을 것읻. 효과적으로 리팩토링하기 위해 반대로 좋고 커다란 설계가 어떤 모습인지 이해할 필요가 있다. 

## 🔎 11장 테스트 리팩토링

테스트 코드는 상당한 투자를 의미한다. 테스트는 결함을 최소화하고 리팩토링으로 프로덕션 시스템을 깔끔하게 유지시켜 주지만, 이것은 지속적인 비용을 의미하기도 한다. 
시스템이 변경됨에 따라 테스트 코드도 다시 들여다보아야 한다. 때때로 변경 사항들을 청소하고 그 결과로 깨진 수많은 테스트를 고쳐야 한다. 

<br>

### 📍 2. 테스트 냄새: 불필요한 테스트 코드 

테스트 메서드는 예외를 기대하지 않는다. 테스트 코드가 예외를 기대하지 않는다면 (명시적으로 예외를 던지는 단계를 설정하지 않았기 때문에) 단지 예외가 날아가게 두면 된다. JUnit이 테스트에서 던지는 예외들을 잡아 준다. 
예외가 발생한 테스트는 오류로 표시되고 출력 창에 스택 트레이스가 보인다. 명시적인 `try/catch` 블록은 부가 가치가 없다. 

어떤 변수를 역으로 참조하기 전에 그것이 `null`이 아님을 검사하는 것은 안전하고 좋은 일일까? 프로덕션 코드에서는 맞지만, 이 테스트에서 `not-null` 단언은 군더더기이다. 추가되었을 때 이점이 없다. 불필요한 테스트 코드는 제거한다. 

<br>

### 📍 3. 테스트 냄새: 추상화 누락 

잘 구성된 테스트는 시스템과 상호 작용을 `데이터 준비하기`, `시스템과 동작하기`, `결과 단언하기` 세 가지 관점에서 보여 준다. 추상화로 필수적인 개념을 최대화하고 불필요한 세부 사항은 감춘다. 

**좋은 테스트는 클라이언트가 시스템과 어떻게 상호 작용하는지 추상화한다.**

단일 개념을 구현하는 2줄 혹은 3줄이 넘는 코드를 발견했다면 테스트에 그것을 깔끔한 문장 1줄로 추출할 수 있는지 고민해라.

<br>

### 📍 4. 테스트 냄새: 부적절한 정보

잘 추상화된 테스트는 코드를 이해하는 데 중요한 것을 부각시켜 주고 그렇지 않은 것은 보이지 않게 해 준다. 
테스트에 사용된 데이터는 스토리를 말하는데 도움을 주어야 한다. 

때때로 테스트에는 부적절하지만, 당장 컴파일되어야 하기 때문에 데이터를 넣기도 한다.
메서드가 테스트에는 어떤 영향도 없는 부가적인 인수를 취하기도 한다. 
나은 해결책은 의미 있는 이름을 가진 상수를 도입하여 즉시 파악할 수 있도록 하는 것이다. 

<br>

### 📍 5. 테스트 냄새: 부푼 생성

<br>

### 📍 6. 테스트 냄새: 다수의 단언

테스트마다 단언 한 개로 가는 방향은 좋은 생각이다. 때때로 단일 테스트에 다수의 사후 조건에 대한 단언이 필요하기는 하지만, 그보다 더 자주 여러 개의 단언이 있다는 것은 테스트 케이스를 두 개 포함하고 있다는 증거이다. 

단일 목적의 테스트는 주석이 없어도 더 나은 테스트 이름으로 대신할 수 있다. 

**테스트마다 단언 한 개로 가면 테스트 이름을 깔끔하게 만들기 쉽다.**

<br>

### 📍 7. 테스트 냄새: 테스트와 무관한 세부 사항들 

테스트를 실행할 때는 로그를 끄지만 그렇게 하는 코드는 테스트의 정수를 이해하는 데 방해물이 될 수 있다. 그리고 좋은 코딩 시민으로서 항상 스트림을 사용한 후에는 닫아야 하지만 그것 또한 테스트에서는 군더더기가 될 수 있다.

이러한 군더더기들을 `@Before`와 `@After` 메서드로 이동하라.
세부 내용을 `@Before`, `@After`와 도우미 메서드로 옮길 때는 주의해야 한다. 테스트를 이해하는 데 필요한 유용한 정보는 제거하지 않았는지 확인하라. 

**좋은 테스트는 독자가 테스트를 이해하는 데 다른 함수를 파헤치지 않도록 한다.**

<br>

### 📍 8. 테스트 냄새: 잘못된 조직

테스트에서 어느 부분들이 준비(Arrange), 실행(Act), 단언(Assert) 부분인지 아는 것은 테스트를 빠르게 인지할 수 있게 한다. `AAA`를 활용하여 의도를 분명하게 하라. 

<br>

### 📍 9. 테스트 냄새: 암시적 의미 

각 테스트가 분명하게 대답해야 할 가장 큰 질문은 "왜 그러한 결과를 기대하는가?"이다. 테스트 준비와 단언 부분을 상호 연관 지을 수 있어야 한다. 단언이 기대하는 이유가 분명하지 않다면 코드를 읽는 사람들은 그 해답을 얻기 위해 다른 코드를 뒤져 가며 시간을 낭비해야 하기 때문이다. 

테스트를 걸쳐 상호 관련성을 향상시키는 방법은 무한하다. 의미 있는 상수, 더 좋은 변수 이름, 더 좋은 데이터와 때때로 테스트에서 계산을 적게 만드는 것이 도움이 된다. 

<br>

### 📍 10. 새로운 테스트 추가 

<br>

### 📍 11. 마치며 

테스트 이름을 읽고서 어떤 케이스인지 이해할 수 있어야한다. 먼저 테스트의 실행 부분에 집중하여 코드가 무엇을 실행하는지 안다. 준비 부분에서 어떤 맥락으로 테스트가 실행되는지 이해하고, 단언 한 개로 기대하는 결과가 무엇인지 파악한다. 

**테스트로 시스템을 이해하고자 한다면 테스트를 깔끔하게 유지하는 것이 좋다.**

이제 설계라는 이름으로 무엇을 해야 하는지 전체 그림을 얻었다. 
- 프로덕션 코드를 깔끔하고 간결하게 리팩토링
- 프로덕션 코드를 설계할 때 더 많은 유연성을 제공하도록 리팩토링
- 시스템의 의존성 도전 과제에 대해 목을 지원
- 유지 보수 비용을 최소화
- 이해도를 최대화하도록 테스트를 리팩토링
