# 📚 그림으로 배우는 Http & Network Basic
## 📖 7장 웹을 안전하게 지켜주는 HTTPS 🔎

<br>

### 📍 1 HTTP의 약점

- 평문(암호화 하지 않은) 통신이기 때문에 도청 가능
- 통신 상대를 확인하지 않기 때문에 위장 가능
- 완전성을 증명할 수 없기 때문에 변조 가능

<br>

- 이 약점은 HTTP만이 아닌, 다른 암호화하지 않은 프로토콜에도 공통되는 문제이다. 

<br>

#### 📎 1.1 평문이기 때문에 도청 가능

<br>

- HTTP를 사용한 리퀘스트나 리스폰스 통신 내용은 HTTP 자신을 암호화하는 기능은 없기 때문에 통신 전체가 암호화 되지는 않는다. 
- 즉, 평문(암호화되지 않은 메시지)으로 HTTP 메시지를 보내게 된다. 

##### TCP/IP는 도청 가능한 네트워크

- 어째서 암호화되어 있지 않은 통신에 약점이 있냐 하면 TCP/IP의 구조의 통신 내용은 전부 통신의 경로의 도중에 엿볼 수 있기 때문이다. 
- 인터넷은 전 세계를 경유하는 네트워크로 되어 있다. 
- 어느 서버와 클라이언트가 통신을 할 때, 통신 경로 상에 있는 네트워크 기기나 케이블이나 컴퓨터 등을 전부 자기 자신이 소유하고 있는 일은 있을 수 없다. 그래서 악의를 가진 누군가가 엿볼 수 있다. 
- 통신 내용을 엿볼 수 있다는 것은, 암호화된 통신에서도 암호화되지 않은 통신도 같다. 
- 암호화 통신은 메시지 속의 의미는 간파할 수 없을 수도 있겠지만 암호화된 메시지 자체는 엿볼 수 있다. 

- 네트워크 상을 흐르고 있는 패킷을 수집하는 것만으로 도청할 수 있게 된다. 

##### 암호화로 도청을 피하다

1. 통신 암호화
- HTTP에는 암호화 구조는 없지만 `SSL(Secure Socket Layer)`이나 `TLS(Transport Layer Security)`이라는 다른 프로토콜을 조합함으로써 HTTP의 통신 내용을 암호화할 수 있다. 
- SSL 등을 이용해 안전한 통신로를 확립하고 나서 그 통신로를 사용해 HTTP 통신을 한다. 
- SSL을 조합한 HTTP를 HTTPS(HTTP Secure)나 HTTP over SSL이라 불리고 있다. 

2. 콘텐츠 암호화 
- 통신하고 있는 콘텐츠의 내용 자체를 암호화해 버리는 방법
- HTTP에 암호화를 하는 기능은 없기 때문에 HTTP를 사용해서 운반하는 내용을 암호화하는 것이다. 
- 즉, HTTP 메시지에 포함되는 콘텐츠만 암호화하는 것이다. 
- 클라이언트에서 HTTP 메시지를 암호화해서 출력하는 처리가 필요하게 된다. 
- 콘텐츠의 암호화를 유효하게 하기 위해서는 클라이언트와 서버가 콘텐트의 암호화나 복호화 구조를 가지고 있는 것이 전제가 되므로, 평상시에 유저가 사용하는 브라우저와 웹 서버에서는 이용하는 것은 어렵다. 주로 웹 서비스 등에서 이용되는 방법이다. 

<br>

#### 📎 1.2 통신 상대를 확인하지 않기 때문에 위장 가능

<br>

- HTTP를 사용한 리퀘스트나 리스폰스에서는 통신 상대를 확인하지 않는다. 
- 리퀘스트를 보낸 서버가 정말로 URI에서 지정된 호스트인지 아닌지, 리스폰스를 반환한 클라이언트가 정말로 리퀘스트를 출력한 클라이언트인지 아닌지를 모른다. 

<br>

##### 누구나 리퀘스트할 수 있다

- HTTP에 의한 통신에는 상대가 누구인지 확인하는 처리는 없기 때문에 누구든지 리퀘스트를 보낼 수 있다. 
- 리퀘스트가 오면 상대가 누구든지 무언가의 리스폰스를 반환한다. (단, IP 주소나 포트 등에서 그 웹 서버에 액세스 제한이 없는 경우)
- HTTP는 누구이던 간에 리퀘스트를 보내면 리스폰스가 반환되는 매우 심플한 구조로 되어 있지만, 상대를 확인하지 않는 점이 약점일 수가 있다. 
  - 리퀘스트를 보낸 곳의 웹 서버가 원래 의도한 리스폰스를 보내야 하는 웹 서버인지 아닌지를 확인할 수 없다. 위장한 웹 서버일 우려가 있다. 
  - 리스폰스를 반환한 곳의 클라이언트가 원래 의도한 리퀘스트를 보낸 클라이언트인지 아닌지를 확인할 수 없다. 위장한 클라이언트일 우려가 있다. 
  - 통신하고 있는 상대가 접근이 허가된 상대인지 아닌지를 확인할 수 없다. 중요한 정보를 가진 웹 서버에서는 특정 상대만 통신을 허가하고 싶을 때가 있다. 
  - 어디의 누가 리퀘스트를 했는지를 확인할 수 없다. 
  - 의미없는 리퀘스트라도 수신하게 된다. 대량의 리퀘스트에 의한 DoS 공격(서비스 불능 공격)을 방지할 수가 없다. 

<br>

##### 상대를 확인하는 증명서 
- HTTP에서는 통신 상대를 확인할 수 없지만 SSL로 상대를 확인할 수 있다. 
- SSL은 암호화뿐만 아니라 상대를 확인하는 수단으로 증명서를 제공하고 있다. 
- 통신 상대의 서버나 클라이언트가 가진 증명서를 확인함으로써 통신 상대가 내가 통신하고자 하는 상대인지 아닌지를 판단할 수 있다. 
- 신뢰할 수 있는 제3자란, 기본적으로 사회에서 인정된 기업이나 조직을 가리킨다. 
- 이 증명서를 이용함으로써, 통신 상대가 내가 통신하고자 하는 서버임을 나타내고 이용자는 개인 정보 누설 등의 위험성이 줄어들게 된다. 
- 또한, 클라이언트가 증명서를 가짐으로써 본인 확인을 하고, 웹 사이트 인증에서 이용할 수도 있다. 

<br>

#### 📎 1.3 완전성을 증명할 수 없기 때문에 변조 가능

<br>

- 완전성이란 정보의 정확성을 가리킨다. 
- 그것을 증명할 수 없다는 것은 정보가 정확한지 아닌지를 확인할 수 없음을 의미한다. 

<br>

##### 수신한 내용이 다를지도 모른다.

- HTTP가 완전성을 증명할 수 없다는 뜻은 만약 리퀘스트나 리스폰스가 발신된 후에 상대가 수신할 때까지의 사이에 변조되었다고 하더라도 이 사실을 알 수 없다는 뜻
- 즉, 발신된 리퀘스트나 리스폰스와 수신한 리퀘스트나 리스폰스가 같은지 아닌지를 확인할 수 없다는 의미이다. 
- 예를 들어, 어떤 웹 사이트에서 콘텐츠를 다운로드 했다고 하면 클라이언트에 다운로드한 파일과 서버 상에 있는 파일이 정말로 같은 것인지 아닌지 모른다는 것이다. 
- 이와 같이 공격자가 도중에 리퀘스트나 리스폰스를 빼앗아 변조하는 공격을 중간자 공격(Man-in-the-Middle 공격)이라고 부른다.

<br>

##### 변조를 방지하려면?

- HTTP를 사용해서 완전성을 확인하기 위한 방법은 있지만, 확실하면서 편리한 방법은 현재로서는 존재하지 않는다. 
- 그 중에서도 자주 사용되고 있는 방법은 MD5나 SHA-1 등의 해시 값을 확인하는 방법과 파일의 디지털 서명을 확인하는 방법이다. 
- 확실히 방지하기에는 HTTPS를 사용할 필요가 있다. 
- SSL에는 인증이나 암호화, 그리고 다이제스트 기능을 제공하고 있다. 
- HTTP만으로는 완전성을 보증하는 것이 어렵기 때문에 다른 프로토콜을 조합함으로써 실현하고 있다. 

<br>

### 📍 2 HTTP + 암호화 + 인증 + 완전성 보호 = HTTPS

<br>

#### 📎 2.1 HTTP에 암호화와 인증과 완전성 보호를 더한 HTTPS

- HTTP통신은 암호화되지 않은 평문으로 실시된다. 
  - 예를 들면 웹 페이지에서 신용 카드 번호를 입력했을 때 통신이 도청되면 신용 카드 번호를 도청당하게 된다. 
- HTTP에는 통신 상대의 서버나 클라이언트를 인증하는 수단이 없다. 
  - 실제로는 의도한 통신 상대와 통신하고 있지 않을 가능성이 있다. 
  - 수신한 메시지가 도중에 변조되어 있을 가능성도 생각할 수 있다. 
- 이러한 문제를 해결하기 위해서는 암호화와 인증과 완전성 보호 같은 구조를 HTTP에 추가할 필요가 있다. 
- HTTP에 암호화나 인증 등의 구조를 더한 것을 HTTPS(HTTP Secure)라고 부른다. 

<br>

#### 📎 2.2 HTTPS는 SSL의 껍질을 덮어쓴 HTTP

<br>

- HTTPS는 새로운 애플리케이션 계층의 프로토콜은 아니다. 
- HTTP 통신을 하는 소켓 부분을 SSL(Secure Socket Layer)이나 TLS(Transport Layer Security)이라는 프로토콜로 대체하고 있을 뿐이다. 
- 보통 HTTP는 직접 TCP와 통신하지만 SSL을 사용한 경우에는 HTTP는 SSL와 통신하고 SSL이 TCP와 통신하게 된다. 
- 즉, SSL이라는 껍질을 덮어 쓴 HTTP가 HTTPS인 것이다. 

<br>

- SSL을 사용함으로써 HTTP는 HTTPS로서 암호화와 증명서와 완전성 보호를 이용할 수 있게 된다. 
- SSL은 HTTP와는 독립된 프로토콜로 HTTP만으로는 애플리케이션 계층에서 동작하는 SMTP나 Telnet 등에서도 이용될 수 있다. 
- SSL은 현재 세계 어느 곳에서도 널리 사용되고 있는 네트워크 보안 기술이라고 말할 수 있다. 

<br>

#### 📎 2.3 상호간에 키를 교환하는 공개키 암호화 방식

<br>

- SSL을 설명하기 전에 암호화 방식에 대해서 설명한다. 
- SSL에서는 공개키 암호화 방식이라 불리는 암호화 방식을 채용하고 있다. 
- 현대의 암호는 알고리즘이 공개되어 있고 키를 비밀에 부침으로써 안전성을 유지한다. 
- 암호화나 복호화할 때 이 키를 사용한다. 
- 키가 없으면 암호를 풀 수는 없지만 반대로 생각해보면 키를 가지고 있다면 누구라도 암호를 풀 수가 있다. 
- 공격자가 키를 알게 되면 암호화가 의미를 잃어버리게 된다. 

##### 공통키 암호의 딜레마
- 암호화와 복호화에 하나의 키를 같이 사용하는 방식을 공통키 암호라고 부른다. 
- 공통키 암호화 방식은 상대방에게 키를 넘겨주지 않으면 안된다.
- 네트워크를 사용해서 키를 넘겨줄 때 통신이 도청되어 공격장에게 키를 빼앗기게 되면 암호화의 의미가 없게 되어 버린다. 

<br>

##### 두 개의 키를 사용하는 공개키 암호

<br>

- 공통키 암호의 문제를 해결하려고 한 것이 공개키 암호라는 방식이다. 
- 공개키 암호에서는 서로 다른 두 개의 키 페어(쌍)를 사용한다. 
- 한쪽은 비밀키(private key)라 부르고 다른 한쪽은 공개키(public key)라고 부른다. 
- 비밀키는 누구에게도 알려지면 안되는 키이며 공개키는 누구에게나 알려져도 괜찮은 키이다. 

<br>

- 공개키 암호를 사용한 암호화는 암호를 보내는 측이 상대의 공개키를 사용해 암호화를 한다. 
- 암호화된 정보를 받아들인 상대는 자신의 비밀키를 사용해 복호화를 실시한다. 
  - 암호를 푸는 비밀키를 통신으로 보낼 필요가 없기 때문에 도청에 의해서 키를 빼앗길 걱정은 없다. 

<br>

##### HTTPS는 하이브리드 암호 시스템 

- HTTP는 공통키 암호와 공개키 암호의 양쪽 성질을 가진 하이브리드 암호 시스템입니다. 
- 공개키 암호는 공통키 암호에 비해서 처리 속도가 늦다.
- 키를 교환하는 곳에서는 공개키 암호를 사용하고 그 후의 통신에서 메시지를 교환하는 곳에서는 공통키 암호를 사용한다.

<br>

#### 📎 2.4 공개키가 정확한지 아닌지를 증명하는 증명서

<br>

- 아쉽게도 공개키 암호에도 문제점이 있다. 공개키가 진짜인지 아닌지를 증명할 수 없다는 것이다. 
- 이 문제를 해결하는 데는 인증 기관과 그 기관이 발행하는 공개키 증명서가 이용되고 있다. 
- 인증 기관이란 클라이언트와 서버가 모두 신뢰하는 제3자 기관이다. 유명한 인증 기관에는 VeriSign사가 있다. 
- 인증 기관은 먼저 서버의 운영자가 인증 기관에 공개키를 제출한다. 
- 인증 기관은 제출된 공개키에 디지털 서명을 하고 서명이 끝난 공개키를 만든다. 
- 그리고 공개키 인증서에 서명이 끝난 공개키를 담는다. 
- 서버는 이 인증 기관에 의해서 작성된 공개키 인증서(증명서)를 클라이언트에 보내고 공개키 암호로 통신을 한다. 
- 증명서를 받은 클라이언트는 증명 기관의 공개키를 사용해서 서버의 공개키를 인증한 것이 진짜 인증 기관이라는 것과 서버의 공개키가 신뢰할 수 있다는 것을 알 수 있다. 

<br>

##### 조직의 실제성을 증명하는 EV SSL 증명서

- 증명서의 역할은 서버가 올바른 통신 상대임을 증명하는 것이지만, 상대방이 실제로 있는 기업인지를 확인하는 역할도 있다. 그러한 역할을 가진 증명서를 EV SSL 증명서라고 한다. 
- EV SSL 증명서는 세계 표준의 인정 가이드라인에 의해서 발행되는 증명서이다. 운영하는 조직의 실재성을 확인하는 방법을 엄격히 규정하고 있기 때문에 웹 사이트의 신뢰성을 더욱 더 높일 수 있다. 
- 브라우저의 주소창의 색이 녹색으로 변하면 EV SSL 증명서로 증명된 웹 사이트인 것을 시각적으로 알 수 있다. 그리고 주소창의 옆에는 SSL 증명서에 기재되어 있는 조직명 및 증명서를 발행한 인증 기관 명이 표시된다. 

<br>

##### 클라이언트를 확인하는 클라이언트 증명서

- HTTPS에서는 클라이언트 증명서도 이용할 수 있다. 
- 클라이언트 증명서를 이용하여 서버 증명서와 같이 서버가 통신하고 있는 상대가 의도한 클라이언트인 것을 증명하는 클라이언트 인증을 할 수 있다. 
- 클라이언트 증명서는 몇 가지 문제점이 있다. 
  - 먼저, 클라이언트 증명서에서 문제가 되는 점은 증명서의 입수와 배포이다. 
  - 유저가 클라이언트 증명서를 인스톨할 필요가 있다. 
  - 클라이언트 증명서는 유료로 구입할 필요가 있기 때문에 유저 수만큼 비용이 들게 된다. 
  - 여러 유저가 인스톨 작업을 해야 하는 것도 큰 일이다. 
- 안전성이 매우 높은 인증 기능을 제공할 수 있지만 특정 용도로만 사용되는 실정이다. 
- 클라이언트 인증은 그 만큼 비용을 들일 필요가 있는 곳에서만 사용되고 있다. 
- 클라이언트 증명서의 또 다른 문제점은 클라이언트 인증서는 어디까지나 클라이언트의 실재를 증명할 뿐, 사용자의 존재 유무를 증명하는 증명서는 아닌다. 
- 즉, 클라이언트 증명서가 들어간 컴퓨터를 사용할 권한이 있다면 누구든지 클라이언트 증명서를 이용할 수 있다. 

<br>

##### 인증 기관은 신용이 제일 

